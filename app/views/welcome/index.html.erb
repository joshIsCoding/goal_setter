<h1>Resolute - the goal setting app!</h1>
<section id="welcome" class="welcome">
   <% if is_logged_in? %>
   <div class="start_panel">
      <h2>Let's Get Started!</h2>
      <ul>
         <li>
            Set a <%= link_to "new goal", new_user_goal_url(current_user) %>!
         </li>
         <li>
            View all <%= link_to "your goals", user_url(current_user) %> and the goals you're supporting.
         </li>
      </ul>
   </div>
   <% else %>
   <div class="unrecognised_user">
      <div class="register">
         <h3>New here?</h3>
         <p>Register with us to set, update and track your own goals. Join our growing community and support each others' goals!</p>
         <%= button_to "Create an Account", new_user_url, method: :get %>
      </div>
      <div class="login">
         <h3>Old face?</h3>
         <p>Welcome back! You know the drill: log back into your account to continue tracking your goals.</p>
         <%= button_to "Log Back In", new_session_url, method: :get %>
      </div>
   </div>
   <% end %>
</section>
<!-- GOAL AND USER LEADERBOARDS -->
<section id="leaderboards" class="leaderboard">
<h2>Most Productive Users</h2>
<% user_headings = ["Rank", "Username", "Goals Set", "Completion Rate"] %>
   <table id="user_leaderboard" class="leaderboard">
      <thead>
         <% user_headings.each do |heading| %>
         <th>
            <%= heading %>
         </th>
         <% end %>
      </thead>
      <tbody>
         <% User.leaderboard.each_with_index do |user, i| %>
         <tr>
            <td><%= i+1 %></td>
            <td><%= link_to user.username, user_url(user) %></td>
            <td><%= user.goal_count %></td>
            <td><%= number_with_precision(
               user.goal_completion_rate, 
               precision: 2, 
               strip_insignificant_zeros: true) %>%</td>
         </tr>
         <% end %>
      </tbody>
   </table>
   <p>Check out <%= link_to "all our users.", users_url %></p>

   <h2>Most Popular Goals</h2>
   <% goal_headings = ["Rank", "Title", "Upvotes", "Status", "Details"] %>
   <table id="goal_leaderboard" class="leaderboard">
      <thead>
         <% goal_headings.each do |heading| %>
         <th>
            <%= heading %>
         </th>
         <% end %>
      </thead>
      <tbody>
         <% Goal.leaderboard.each_with_index do |goal, i| %>
         <tr>
            <td><%= i+1 %></td>
            <td><%= link_to goal.title, goal_url(goal) %></td>
            <td><%= goal.up_votes_count %></td>
            <td><%= goal.status %></td>
            <td><%= link_to goal.user.username, user_url(goal.user) %></td>
            <td><%= goal.details %></td>
         </tr>
         <% end %>
      </tbody>
   </table>
   <p>Browse <%= link_to "all goals", goals_url %>.</p>
</section>
